# Kuber Bootstrap

Инструмент для ручного развёртывания узлов Kubernetes без встроенного etcd. Скрипты написаны на Python 3 и используют только стандартную библиотеку и Jinja2.

## Требования

- Python 3.8+
- Jinja2 (`pip install jinja2`)
- root-права для создания systemd unit'ов и сертификатов

## Состав репозитория

- `data/collect_node_info.py` – собирает IP, архитектуру и роль узла, сохраняет в `data/collected_info.py`.
- `setup/` – установка зависимостей и Helm, проверка бинарников.
- `certs/` – генерация и проверка сертификатов.
- `kubeadm/` – подготовка конфигурации и запуск фаз инициализации.
- `kubelet/` – создание конфигурации kubelet и kubeconfig.
- `systemd/` – генерация unit-файлов для etcd и kube-apiserver.
- `post/` – установка CNI и постконфигурация control-plane.
- `cluster/` – вспомогательные утилиты для проверки состояния кластера.
- `data/` – шаблоны unit-файлов и прочие параметры.
- `main.py` – оркестратор, выполняющий шаги установки.

## Быстрый старт

1. Запустите `python3 main.py control-plane` для control-plane либо `python3 main.py worker` для worker-ноды.
2. Скрипт поочерёдно выполнит все необходимые шаги, выводя ход процесса в консоль.

## Этапы установки

### Control-plane

1. Установка зависимостей и проверка бинарников.
2. Настройка kubelet и временной сети.
3. Генерация всех сертификатов.
4. Запуск etcd и kube-apiserver в режиме *dev*.
5. Генерация конфигурации kubeadm и kubeconfig'ов.
6. Инициализация кластера и установка Cilium.
7. Запуск controller-manager и scheduler, перевод apiserver в режим *prod*.

### Worker

1. Установка зависимостей и проверка бинарников.
2. Патч параметров kubelet и установка Helm.
3. Выполнение команды `kubeadm join` (скрипт ожидается в будущем).

## Проверка кода

Автотесты отсутствуют. Для проверки синтаксиса выполните:

```bash
python -m py_compile $(git ls-files '*.py')
```
