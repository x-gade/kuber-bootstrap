kubeProxyReplacement: "partial"
k8sServiceHost: {{ IP }}
k8sServicePort: {{ PORT }}
debug:
  enabled: true
  verbose: "datapath envoy"

ipam:
  mode: "cluster-pool"
  operator:
    clusterPoolIPv4PodCIDRList:
      - "{{ CLUSTER_POD_CIDR }}"
    clusterPoolIPv4MaskSize: 24

hostServices:
  enabled: false

externalIPs:
  enabled: true

nodePort:
  enabled: true

endpointSlices:
  enabled: true

routingMode: "native"
ipv4NativeRoutingCIDR: "{{ CLUSTER_POD_CIDR }}"
tunnel: "disabled"

ipv4:
  enabled: true

ipv6:
  enabled: false

bpf:
  masquerade: true

agent:
  enabled: true
  env:
    - name: CILIUM_DEBUG
      value: "true"
  nodeSelector:
    node-role.kubernetes.io/control-plane: "true"
  {% if ENABLE_TOLERATIONS %}
  tolerations:
    - key: "node-role.kubernetes.io/control-plane"
      operator: "Exists"
      effect: "NoSchedule"
    - key: "node.kubernetes.io/not-ready"
      operator: "Exists"
      effect: "NoSchedule"
    - key: "node.cilium.io/agent-not-ready"
      operator: "Exists"
      effect: "NoSchedule"
  {% endif %}
  {% if not DISABLE_AGENT_AFFINITY %}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                io.cilium/app: cilium
            topologyKey: kubernetes.io/hostname
  {% endif %}

operator:
  enabled: true
  replicas: {{ REPLICAS }}
  env:
    - name: CILIUM_DEBUG
      value: "true"
  nodeSelector:
    node-role.kubernetes.io/control-plane: "true"
  {% if ENABLE_TOLERATIONS %}
  tolerations:
    - key: "node-role.kubernetes.io/control-plane"
      operator: "Exists"
      effect: "NoSchedule"
    - key: "node.kubernetes.io/not-ready"
      operator: "Exists"
      effect: "NoSchedule"
    - key: "node.cilium.io/agent-not-ready"
      operator: "Exists"
      effect: "NoSchedule"
  {% endif %}
  {% if not DISABLE_AFFINITY %}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                io.cilium/app: operator
            topologyKey: kubernetes.io/hostname
  {% endif %}

hubble:
  enabled: false

cni:
  customConf: true
