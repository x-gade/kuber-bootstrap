TLS-СЕРТИФИКАТЫ ДЛЯ KUBERNETES
===============================

Этот модуль содержит два основных скрипта для управления TLS-сертификатами Kubernetes:

1. generate_all.py — генерация всех сертификатов
2. renew_certs.py — ежедневная проверка и автоматическое продление

---

generate_all.py
------------------

Назначение: Скрипт генерирует все ключевые TLS-сертификаты, необходимые для работы control-plane и компонентов кластера.

Генерируемые сертификаты:
    - apiserver.crt / key
    - admin.crt / key
    - etcd.crt / key
    - kubelet-client.crt / key
    - sa.key / sa.pub (service-account)
    - cilium.crt / key
    - cilium-webhook.crt / key
    - другие, при необходимости

Путь хранения:
    Все сертификаты сохраняются в указанную директорию (обычно `/etc/kubernetes/pki`).

Дополнительно:
    - Генерируется `cert_info.json` — журнал метаданных сертификатов (имя, дата выпуска, срок действия).
    - Настраивается systemd timer для автоматической ежедневной проверки валидности.

Использование:
    Запускается вручную или вызывается другими модулями.
    
    Пример:
        sudo python3 generate_all.py

---

renew_certs.py
------------------

Назначение:
    Проверяет актуальность всех сертификатов, записанных в `cert_info.json`, и продлевает те, срок которых истекает менее чем через 30 дней.

Логика работы:
    - Загружает `cert_info.json`
    - Находит устаревающие или истекающие сертификаты
    - Вызывает `generate_all.py` для их регенерации
    - Перезапускает соответствующие systemd-сервисы (например, kube-apiserver, etcd)

Периодичность:
    Запускается автоматически через systemd timer один раз в день.

Безопасность:
    - Не трогает валидные сертификаты
    - Поддерживает безопасную регенерацию (например, сначала сертификат, затем перезапуск сервиса)
    - Поддерживает резервные копии и логирование

Использование вручную:
    sudo python3 renew_certs.py

---

Служебные файлы
------------------

- cert_info.json — журнал с метаданными сертификатов:
      {
          "admin.crt": {
              "created": "2025-07-01T12:00:00",
              "expires": "2026-07-01T12:00:00",
              "path": "/etc/kubernetes/pki/admin.crt"
          },
          ...
      }

- systemd-таймер (создаётся автоматически): `renew-certs.timer` запускает `renew_certs.py` ежедневно.

---

Назначение всей системы
--------------------------

Обеспечить непрерывную, безопасную и автоматизированную работу control-plane Kubernetes без ручного обновления сертификатов.

---
